I"·T<h2 id="1-react-hooks">1. React Hooks</h2>
<p>Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§</p>

<p>å¦‚æœä½ åœ¨ç¼–å†™å‡½æ•°ç»„ä»¶å¹¶æ„è¯†åˆ°éœ€è¦å‘å…¶æ·»åŠ ä¸€äº› stateï¼Œä»¥å‰çš„åšæ³•æ˜¯å¿…é¡»å°†å…¶å®ƒè½¬åŒ–ä¸º classã€‚ç°åœ¨ä½ å¯ä»¥åœ¨ç°æœ‰çš„å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ Hook</p>

<h2 id="2-è§£å†³çš„é—®é¢˜">2. è§£å†³çš„é—®é¢˜</h2>
<p>åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾,å¯èƒ½è¦ç”¨åˆ°render propså’Œé«˜é˜¶ç»„ä»¶ï¼ŒReact éœ€è¦ä¸ºå…±äº«çŠ¶æ€é€»è¾‘æä¾›æ›´å¥½çš„åŸç”Ÿé€”å¾„ï¼ŒHook ä½¿ä½ åœ¨æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘</p>

<p>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£ï¼ŒHook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆæ¯”å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰</p>

<p>éš¾ä»¥ç†è§£çš„ class,åŒ…æ‹¬éš¾ä»¥æ‰æ‘¸çš„this</p>

<h2 id="3-æ³¨æ„äº‹é¡¹">3. æ³¨æ„äº‹é¡¹</h2>
<p>åªèƒ½åœ¨å‡½æ•°æœ€å¤–å±‚è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…å­å‡½æ•°ä¸­è°ƒç”¨ã€‚</p>

<p>åªèƒ½åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookã€‚ä¸è¦åœ¨å…¶ä»– JavaScript å‡½æ•°ä¸­è°ƒç”¨</p>

<h2 id="4-usestate">4. useState</h2>
<p>useState å°±æ˜¯ä¸€ä¸ª Hook</p>

<p>é€šè¿‡åœ¨å‡½æ•°ç»„ä»¶é‡Œè°ƒç”¨å®ƒæ¥ç»™ç»„ä»¶æ·»åŠ ä¸€äº›å†…éƒ¨ state,React ä¼šåœ¨é‡å¤æ¸²æŸ“æ—¶ä¿ç•™è¿™ä¸ª state</p>

<p>useState ä¼šè¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çŠ¶æ€å’Œä¸€ä¸ªè®©ä½ æ›´æ–°å®ƒçš„å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æˆ–å…¶ä»–ä¸€äº›åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å®ƒç±»ä¼¼ class ç»„ä»¶çš„ this.setStateï¼Œä½†æ˜¯å®ƒä¸ä¼šæŠŠæ–°çš„ state å’Œæ—§çš„ state è¿›è¡Œåˆå¹¶</p>

<p>useState å”¯ä¸€çš„å‚æ•°å°±æ˜¯åˆå§‹ state</p>

<p>è¿”å›ä¸€ä¸ª stateï¼Œä»¥åŠæ›´æ–° state çš„å‡½æ•°</p>

<p>åœ¨åˆå§‹æ¸²æŸ“æœŸé—´ï¼Œè¿”å›çš„çŠ¶æ€ (state) ä¸ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° (initialState) å€¼ç›¸åŒ</p>

<p>setState å‡½æ•°ç”¨äºæ›´æ–° stateã€‚å®ƒæ¥æ”¶ä¸€ä¸ªæ–°çš„ state å€¼å¹¶å°†ç»„ä»¶çš„ä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—</p>

<p>const [state, setState] = useState(initialState);</p>

<h3 id="41-è®¡æ•°å™¨">4.1 è®¡æ•°å™¨</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import React,{useState} from 'react';
class Counter extends React.Component {
  constructor(props) {
      super(props);
      this.state = {
          number: 0
      };
  }
  render() {
      return (
          &lt;div&gt;
              &lt;p&gt;{this.state.number}&lt;/p&gt;
              &lt;button onClick={() =&gt; this.setState({ number: this.state.number + 1 })}&gt;
                  +
        &lt;/button&gt;
          &lt;/div&gt;
      );
  }
}
function Counter2(){
  const [number,setNumber] = useState(0);
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
          &lt;button onClick={()=&gt;setNumber(number+1)}&gt;+&lt;/button&gt;
      &lt;/&gt;
  )
}
export default Counter2;
</code></pre></div></div>

<h3 id="42-æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ç‹¬ç«‹çš„é—­åŒ…">4.2 æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ç‹¬ç«‹çš„é—­åŒ…</h3>
<p>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and State</p>

<p>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°</p>

<p>alertä¼šâ€œæ•è·â€æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚</p>

<p>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­numberå€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼</p>

<p>åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œpropså’Œstateå§‹ç»ˆä¿æŒä¸å˜</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter2(){
  const [number,setNumber] = useState(0);
  function alertNumber(){
    setTimeout(()=&gt;{
      alert(number);
    },3000);
  }
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
          &lt;button onClick={()=&gt;setNumber(number+1)}&gt;+&lt;/button&gt;
          &lt;button onClick={alertNumber}&gt;alertNumber&lt;/button&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h3 id="43-å‡½æ•°å¼æ›´æ–°">4.3 å‡½æ•°å¼æ›´æ–°</h3>
<p>å¦‚æœæ–°çš„ state éœ€è¦é€šè¿‡ä½¿ç”¨å…ˆå‰çš„ state è®¡ç®—å¾—å‡ºï¼Œé‚£ä¹ˆå¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™ setStateã€‚è¯¥å‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„ stateï¼Œå¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter2(){
  const [number,setNumber] = useState(0);
  let numberRef = useRef(number);
  numberRef.current = number;
  function alertNumber(){
    setTimeout(()=&gt;{
      alert(numberRef.current);
    },3000);
  }
+  function lazy(){
+    setTimeout(()=&gt;{
+      setNumber(number+1);
+    },3000);
+  }
+  function lazyFunc(){
+    setTimeout(()=&gt;{
+      setNumber(number=&gt;number+1);
+    },3000);
+  }
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
          &lt;button onClick={()=&gt;setNumber(number+1)}&gt;+&lt;/button&gt;
          &lt;button onClick={lazy}&gt;lazy+&lt;/button&gt;
          &lt;button onClick={lazyFunc}&gt;lazyFunc+&lt;/button&gt;
          &lt;button onClick={alertNumber}&gt;alertNumber&lt;/button&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h3 id="44-æƒ°æ€§åˆå§‹-state">4.4 æƒ°æ€§åˆå§‹ state</h3>
<p>initialState å‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥</p>

<p>å¦‚æœåˆå§‹ state éœ€è¦é€šè¿‡å¤æ‚è®¡ç®—è·å¾—ï¼Œåˆ™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨</p>

<p>ä¸ class ç»„ä»¶ä¸­çš„ setState æ–¹æ³•ä¸åŒï¼ŒuseState ä¸ä¼šè‡ªåŠ¨åˆå¹¶æ›´æ–°å¯¹è±¡ã€‚ä½ å¯ä»¥ç”¨å‡½æ•°å¼çš„ setState ç»“åˆå±•å¼€è¿ç®—ç¬¦æ¥è¾¾åˆ°åˆå¹¶æ›´æ–°å¯¹è±¡çš„æ•ˆæœ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter3(){
  const [{name,number},setValue] = useState(()=&gt;{
    return {name:'è®¡æ•°å™¨',number:0};
  });
  return (
      &lt;&gt;
          &lt;p&gt;{name}:{number}&lt;/p&gt;
          &lt;button onClick={()=&gt;setValue({number:number+1})}&gt;+&lt;/button&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h3 id="45-æ€§èƒ½ä¼˜åŒ–">4.5 æ€§èƒ½ä¼˜åŒ–</h3>
<p>4.5.1 Object.is</p>

<p>è°ƒç”¨ State Hook çš„æ›´æ–°å‡½æ•°å¹¶ä¼ å…¥å½“å‰çš„ state æ—¶ï¼ŒReact å°†è·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠ effect çš„æ‰§è¡Œã€‚ï¼ˆReact ä½¿ç”¨ Object.is æ¯”è¾ƒç®—æ³• æ¥æ¯”è¾ƒ stateã€‚ï¼‰</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter4(){
const [counter,setCounter] = useState({name:'è®¡æ•°å™¨',number:0});
console.log('render Counter')
return (
    &lt;&gt;
        &lt;p&gt;{counter.name}:{counter.number}&lt;/p&gt;
        &lt;button onClick={()=&gt;setCounter({...counter,number:counter.number+1})}&gt;+&lt;/button&gt;
        &lt;button onClick={()=&gt;setCounter(counter)}&gt;-&lt;/button&gt;
    &lt;/&gt;
)
}
</code></pre></div></div>
<p>4.5.2 å‡å°‘æ¸²æŸ“æ¬¡æ•°</p>

<p>æŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useCallbackï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memoized ç‰ˆæœ¬ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°</p>

<p>æŠŠåˆ›å»ºå‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ useMemoï¼Œå®ƒä»…ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®— memoized å€¼ã€‚è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºé¿å…åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Child({onButtonClick,data}){
  console.log('Child render');
  return (
    &lt;button onClick={onButtonClick} &gt;{data.number}&lt;/button&gt;
  )
}
Child = memo(Child);
function App(){
  const [number,setNumber] = useState(0);
  const [name,setName] = useState('zhufeng');
  const addClick = useCallback(()=&gt;setNumber(number+1),[number]);
  const  data = useMemo(()=&gt;({number}),[number]);
  return (
    &lt;div&gt;
      &lt;input type="text" value={name} onChange={e=&gt;setName(e.target.value)}/&gt;
      &lt;Child onButtonClick={addClick} data={data}/&gt;
    &lt;/div&gt;
  )
}
</code></pre></div></div>

<h2 id="5-usereducer">5. useReducer</h2>
<p>useState çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚ (state, action) =&gt; newState çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ dispatch æ–¹æ³•</p>

<p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state ç­‰</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const [state, dispatch] = useReducer(reducer, initialArg, init);
const initialState = 0;

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {number: state.number + 1};
    case 'decrement':
      return {number: state.number - 1};
    default:
      throw new Error();
  }
}
function init(initialState){
    return {number:initialState};
}
function Counter(){
    const [state, dispatch] = useReducer(reducer, initialState,init);
    return (
        &lt;&gt;
          Count: {state.number}
          &lt;button onClick={() =&gt; dispatch({type: 'increment'})}&gt;+&lt;/button&gt;
          &lt;button onClick={() =&gt; dispatch({type: 'decrement'})}&gt;-&lt;/button&gt;
        &lt;/&gt;
    )
}
</code></pre></div></div>

<h2 id="6-usecontext">6. useContext</h2>
<p>æ¥æ”¶ä¸€ä¸ª context å¯¹è±¡ï¼ˆReact.createContext çš„è¿”å›å€¼ï¼‰å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼</p>

<p>å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ <MyContext.Provider> çš„ value prop å†³å®š</MyContext.Provider></p>

<p>å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„ <MyContext.Provider> æ›´æ–°æ—¶ï¼Œè¯¥ Hook ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™ MyContext provider çš„ context value å€¼</MyContext.Provider></p>

<p>useContext(MyContext) ç›¸å½“äº class ç»„ä»¶ä¸­çš„ static contextType = MyContext æˆ–è€… <MyContext.Consumer></MyContext.Consumer></p>

<p>useContext(MyContext) åªæ˜¯è®©ä½ èƒ½å¤Ÿè¯»å– context çš„å€¼ä»¥åŠè®¢é˜… context çš„å˜åŒ–ã€‚ä½ ä»ç„¶éœ€è¦åœ¨ä¸Šå±‚ç»„ä»¶æ ‘ä¸­ä½¿ç”¨ <MyContext.Provider> æ¥ä¸ºä¸‹å±‚ç»„ä»¶æä¾› context</MyContext.Provider></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const CounterContext = React.createContext();

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {number: state.number + 1};
    case 'decrement':
      return {number: state.number - 1};
    default:
      throw new Error();
  }
}
function Counter(){
  let {state,dispatch} = useContext(CounterContext);
  return (
      &lt;&gt;
        &lt;p&gt;{state.number}&lt;/p&gt;
        &lt;button onClick={() =&gt; dispatch({type: 'increment'})}&gt;+&lt;/button&gt;
        &lt;button onClick={() =&gt; dispatch({type: 'decrement'})}&gt;-&lt;/button&gt;
      &lt;/&gt;
  )
}
function App(){
    const [state, dispatch] = useReducer(reducer, {number:0});
    return (
        &lt;CounterContext.Provider value=&gt;
            &lt;Counter/&gt;
        &lt;/CounterContext.Provider&gt;
    )
}
</code></pre></div></div>
<h2 id="7-effect">7. effect</h2>
<p>åœ¨å‡½æ•°ç»„ä»¶ä¸»ä½“å†…ï¼ˆè¿™é‡ŒæŒ‡åœ¨ React æ¸²æŸ“é˜¶æ®µï¼‰æ”¹å˜ DOMã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ä»¥åŠæ‰§è¡Œå…¶ä»–åŒ…å«å‰¯ä½œç”¨çš„æ“ä½œéƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šäº§ç”Ÿè«åå…¶å¦™çš„ bug å¹¶ç ´å UI çš„ä¸€è‡´æ€§</p>

<p>ä½¿ç”¨ useEffect å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚èµ‹å€¼ç»™ useEffect çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åæ‰§è¡Œã€‚ä½ å¯ä»¥æŠŠ effect çœ‹ä½œä» React çš„çº¯å‡½æ•°å¼ä¸–ç•Œé€šå¾€å‘½ä»¤å¼ä¸–ç•Œçš„é€ƒç”Ÿé€šé“</p>

<p>useEffect å°±æ˜¯ä¸€ä¸ª Effect Hookï¼Œç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚å®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ componentDidMountã€componentDidUpdate å’Œ componentWillUnmount å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª API</p>

<p>è¯¥ Hook æ¥æ”¶ä¸€ä¸ªåŒ…å«å‘½ä»¤å¼ã€ä¸”å¯èƒ½æœ‰å‰¯ä½œç”¨ä»£ç çš„å‡½æ•° useEffect(didUpdate);</p>

<h3 id="71-é€šè¿‡classå®ç°ä¿®æ ‡é¢˜">7.1 é€šè¿‡classå®ç°ä¿®æ ‡é¢˜</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Counter extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        number: 0
      };
    }

    componentDidMount() {
        document.title = `ä½ ç‚¹å‡»äº†${this.state.number}æ¬¡`;
    }

    componentDidUpdate() {
        document.title = `ä½ ç‚¹å‡»äº†${this.state.number}æ¬¡`;
    }

    render() {
      return (
        &lt;div&gt;
          &lt;p&gt;{this.state.number}&lt;/p&gt;
          &lt;button onClick={() =&gt; this.setState({ number: this.state.number + 1 })}&gt;
            +
          &lt;/button&gt;
        &lt;/div&gt;
      );
    }
}
</code></pre></div></div>
<p>åœ¨è¿™ä¸ª class ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç¼–å†™é‡å¤çš„ä»£ç ,è¿™æ˜¯å› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç»„ä»¶åŠ è½½å’Œæ›´æ–°æ—¶æ‰§è¡ŒåŒæ ·çš„æ“ä½œã€‚æˆ‘ä»¬å¸Œæœ›å®ƒåœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œï¼Œä½† React çš„ class ç»„ä»¶æ²¡æœ‰æä¾›è¿™æ ·çš„æ–¹æ³•ã€‚å³ä½¿æˆ‘ä»¬æå–å‡ºä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦åœ¨ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨å®ƒã€‚useEffectä¼šåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åå’Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œ</p>

<h3 id="72-é€šè¿‡effectå®ç°">7.2 é€šè¿‡effectå®ç°</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import React,{Component,useState,useEffect} from 'react';
import ReactDOM from 'react-dom';
function Counter(){
    const [number,setNumber] = useState(0);
    // ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:
    useEffect(() =&gt; {
        // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜
        document.title = `ä½ ç‚¹å‡»äº†${number}æ¬¡`;
    });
    return (
        &lt;&gt;
            &lt;p&gt;{number}&lt;/p&gt;
            &lt;button onClick={()=&gt;setNumber(number+1)}&gt;+&lt;/button&gt;
        &lt;/&gt;
    )
}
ReactDOM.render(&lt;Counter /&gt;, document.getElementById('root'));
</code></pre></div></div>
<p>æ¯æ¬¡æˆ‘ä»¬é‡æ–°æ¸²æŸ“ï¼Œéƒ½ä¼šç”Ÿæˆæ–°çš„ effectï¼Œæ›¿æ¢æ‰ä¹‹å‰çš„ã€‚æŸç§æ„ä¹‰ä¸Šè®²ï¼Œeffect æ›´åƒæ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ† â€”â€” æ¯ä¸ª effect å±äºä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚</p>

<p>7.3 æ¸…é™¤å‰¯ä½œç”¨
å‰¯ä½œç”¨å‡½æ•°è¿˜å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªå‡½æ•°æ¥æŒ‡å®šå¦‚ä½•æ¸…é™¤å‰¯ä½œç”¨</p>

<p>ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæ¸…é™¤å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½å‰æ‰§è¡Œã€‚å¦å¤–ï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼Œåˆ™åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª effect å°±å·²è¢«æ¸…é™¤</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter(){
  const [number,setNumber] = useState(0);
  // ç›¸å½“äºcomponentDidMount å’Œ componentDidUpdate
  useEffect(() =&gt; {
     console.log('å¼€å¯ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨')
     const $timer = setInterval(()=&gt;{
      setNumber(number=&gt;number+1);
     },1000);
      return ()=&gt;{
        console.log('é”€æ¯è€çš„å®šæ—¶å™¨');
        clearInterval($timer);
     } 
  });
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h3 id="74-è·³è¿‡-effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–">7.4 è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–</h3>
<p>å¦‚æœæŸäº›ç‰¹å®šå€¼åœ¨ä¸¤æ¬¡é‡æ¸²æŸ“ä¹‹é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½ å¯ä»¥é€šçŸ¥ React è·³è¿‡å¯¹ effect çš„è°ƒç”¨ï¼Œåªè¦ä¼ é€’æ•°ç»„ä½œä¸º useEffect çš„ç¬¬äºŒä¸ªå¯é€‰å‚æ•°å³å¯</p>

<p>å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Counter(){
  const [number,setNumber] = useState(0);
  // ç›¸å½“äºcomponentDidMount å’Œ componentDidUpdate
  useEffect(() =&gt; {
     console.log('å¼€å¯ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨')
     const $timer = setInterval(()=&gt;{
      setNumber(number=&gt;number+1);
     },1000);
  },[]);
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h3 id="75-useref">7.5 useRef</h3>
<p>useRef è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ .current å±æ€§è¢«åˆå§‹åŒ–ä¸ºä¼ å…¥çš„å‚æ•°ï¼ˆinitialValueï¼‰</p>

<p>è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const refContainer = useRef(initialValue);
</code></pre></div></div>
<p>7.5.1 useRef</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import React, { useState, useEffect, useRef } from 'react';
import ReactDOM from 'react-dom';
function Parent() {
    let [number, setNumber] = useState(0);
    return (
        &lt;&gt;
            &lt;Child /&gt;
            &lt;button onClick={() =&gt; setNumber({ number: number + 1 })}&gt;+&lt;/button&gt;
        &lt;/&gt;
    )
}
let input;
function Child() {
    const inputRef = useRef();
    console.log('input===inputRef', input === inputRef);
    input = inputRef;
    function getFocus() {
        inputRef.current.focus();
    }
    return (
        &lt;&gt;
            &lt;input type="text" ref={inputRef} /&gt;
            &lt;button onClick={getFocus}&gt;è·å¾—ç„¦ç‚¹&lt;/button&gt;
        &lt;/&gt;
    )
}
ReactDOM.render(&lt;Parent /&gt;, document.getElementById('root'));
</code></pre></div></div>
<p>7.5.2 forwardRef
å°†refä»çˆ¶ç»„ä»¶ä¸­è½¬å‘åˆ°å­ç»„ä»¶ä¸­çš„domå…ƒç´ ä¸Š</p>

<p>å­ç»„ä»¶æ¥å—propså’Œrefä½œä¸ºå‚æ•°</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Child(props,ref){
  return (
    &lt;input type="text" ref={ref}/&gt;
  )
}
Child = forwardRef(Child);
function Parent(){
  let [number,setNumber] = useState(0); 
  const inputRef = useRef();
  function getFocus(){
    inputRef.current.value = 'focus';
    inputRef.current.focus();
  }
  return (
      &lt;&gt;
        &lt;Child ref={inputRef}/&gt;
        &lt;button onClick={()=&gt;setNumber({number:number+1})}&gt;+&lt;/button&gt;
        &lt;button onClick={getFocus}&gt;è·å¾—ç„¦ç‚¹&lt;/button&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<p>7.5.3 useImperativeHandle</p>

<p>useImperativeHandle å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼</p>

<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚useImperativeHandle åº”å½“ä¸ forwardRef ä¸€èµ·ä½¿ç”¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function Child(props,ref){
  const inputRef = useRef();
  useImperativeHandle(ref,()=&gt;(
    {
      focus(){
        inputRef.current.focus();
      }
    }
  ));
  return (
    &lt;input type="text" ref={inputRef}/&gt;
  )
}
Child = forwardRef(Child);
function Parent(){
  let [number,setNumber] = useState(0); 
  const inputRef = useRef();
  function getFocus(){
    console.log(inputRef.current);
    inputRef.current.value = 'focus';
    inputRef.current.focus();
  }
  return (
      &lt;&gt;
        &lt;Child ref={inputRef}/&gt;
        &lt;button onClick={()=&gt;setNumber({number:number+1})}&gt;+&lt;/button&gt;
        &lt;button onClick={getFocus}&gt;è·å¾—ç„¦ç‚¹&lt;/button&gt;
      &lt;/&gt;
  )
}
</code></pre></div></div>
<h2 id="8-uselayouteffect">8. useLayoutEffect</h2>
<p>å…¶å‡½æ•°ç­¾åä¸ useEffect ç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ effect</p>

<p>å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“</p>

<p>åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰useLayoutEffectå†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°</p>

<p>å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„ useEffect ä»¥é¿å…é˜»å¡è§†å›¾æ›´æ–°</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function LayoutEffect() {
    const [color, setColor] = useState('red');
    useLayoutEffect(() =&gt; {
        alert(color);
    });
    useEffect(() =&gt; {
        console.log('color', color);
    });
    return (
        &lt;&gt;
            &lt;div id="myDiv" style=&gt;é¢œè‰²&lt;/div&gt;
            &lt;button onClick={() =&gt; setColor('red')}&gt;çº¢&lt;/button&gt;
            &lt;button onClick={() =&gt; setColor('yellow')}&gt;é»„&lt;/button&gt;
            &lt;button onClick={() =&gt; setColor('blue')}&gt;è“&lt;/button&gt;
        &lt;/&gt;
    );
}
</code></pre></div></div>
<h2 id="9-è‡ªå®šä¹‰-hook">9. è‡ªå®šä¹‰ Hook</h2>
<p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæƒ³è¦åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨ä¸€äº›çŠ¶æ€é€»è¾‘</p>

<p>è‡ªå®šä¹‰ Hook å¯ä»¥è®©ä½ åœ¨ä¸å¢åŠ ç»„ä»¶çš„æƒ…å†µä¸‹è¾¾åˆ°åŒæ ·çš„ç›®çš„</p>

<p>Hook æ˜¯ä¸€ç§å¤ç”¨çŠ¶æ€é€»è¾‘çš„æ–¹å¼ï¼Œå®ƒä¸å¤ç”¨ state æœ¬èº«</p>

<p>äº‹å®ä¸Š Hook çš„æ¯æ¬¡è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ state</p>

<p>è‡ªå®šä¹‰ Hook æ›´åƒæ˜¯ä¸€ç§çº¦å®šï¼Œè€Œä¸æ˜¯ä¸€ç§åŠŸèƒ½ã€‚å¦‚æœå‡½æ•°çš„åå­—ä»¥ use å¼€å¤´ï¼Œå¹¶ä¸”è°ƒç”¨äº†å…¶ä»–çš„ Hookï¼Œåˆ™å°±ç§°å…¶ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ Hook</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function useNumber(){
  const [number,setNumber] = useState(0);
  useEffect(() =&gt; {
     console.log('å¼€å¯ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨')
     const $timer = setInterval(()=&gt;{
      setNumber(number+1);
     },1000);
     return ()=&gt;{
      console.log('é”€æ¯è€çš„å®šæ—¶å™¨')
         clearInterval($timer);
     }
  });
  return number;
}
function Counter1(){
  let number1 = useNumber();
  return (
      &lt;&gt;
          &lt;p&gt;{number1}&lt;/p&gt;
      &lt;/&gt;
  )
}
function Counter2(){
  let number = useNumber();
  return (
      &lt;&gt;
          &lt;p&gt;{number}&lt;/p&gt;
      &lt;/&gt;
  )
}
function App(){
  return &lt;&gt;&lt;Counter1/&gt;&lt;Counter2/&gt;&lt;/&gt;
}
</code></pre></div></div>
<h2 id="10é™„å½•">10.é™„å½•</h2>
<h3 id="101-æµè§ˆå™¨æ˜¯å¦‚ä½•å‘ˆç°ä¸€å¼ é¡µé¢çš„">10.1 æµè§ˆå™¨æ˜¯å¦‚ä½•å‘ˆç°ä¸€å¼ é¡µé¢çš„</h3>
<p>è§£æHTMLï¼Œå¹¶ç”Ÿæˆä¸€æ£µDOM tree</p>

<p>è§£æå„ç§æ ·å¼å¹¶ç»“åˆDOM treeç”Ÿæˆä¸€æ£µRender tree</p>

<p>å¯¹Render treeçš„å„ä¸ªèŠ‚ç‚¹è®¡ç®—å¸ƒå±€ä¿¡æ¯ï¼Œæ¯”å¦‚boxçš„ä½ç½®ä¸å°ºå¯¸</p>

<p>æ ¹æ®Render treeå¹¶åˆ©ç”¨æµè§ˆå™¨çš„UIå±‚è¿›è¡Œç»˜åˆ¶</p>
:ET