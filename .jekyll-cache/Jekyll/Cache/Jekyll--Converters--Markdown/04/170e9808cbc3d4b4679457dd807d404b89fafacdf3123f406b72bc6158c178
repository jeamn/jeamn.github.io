I"æ[<p>æœ¬æ¬¡æœåŠ¡ç«¯éƒ¨ç½²æŠ˜è…¾ä¹‹æ—…ï¼Œå®Œå…¨æ˜¯å‡ºäºå…´è¶£çˆ±å¥½ã€‚ä¸»è¦æ˜¯æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
  <li>nodeæ¥å£æœåŠ¡çš„ç®€å•éƒ¨ç½²ï¼Œå®ç°å‰ç«¯åœ¨åç«¯æ¥å£æœªå®ç°æ—¶ï¼Œè‡ªå·±æ¨¡æ‹Ÿå¼€å‘æ•°æ®è¾…åŠ©å¼€å‘</li>
  <li>å‰ç«¯é™æ€èµ„æºé¡µé¢çš„éƒ¨ç½²</li>
</ul>

<p>æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼š <br />
NodeåŸºç¡€çŸ¥è¯†ã€VueåŸºç¡€çŸ¥è¯†ã€PM2 ç®€å•ä½¿ç”¨ã€é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨çš„åŸºæœ¬çŸ¥è¯†åŠå®‰å…¨ç­–ç•¥ã€NginxåŸºæœ¬çŸ¥è¯†ã€SSH ç™»å½•åŠæƒé™è®¾ç½®ã€GitåŸºæœ¬æ“ä½œâ€¦</p>

<p>è®¾å¤‡ç¯å¢ƒï¼š
MacBook Proã€iTerm2</p>

<h2 id="ä¸€æœåŠ¡å™¨çš„æ­å»º">ä¸€ã€æœåŠ¡å™¨çš„æ­å»º</h2>
<h3 id="æœåŠ¡å™¨åŸºæœ¬é…ç½®">æœåŠ¡å™¨åŸºæœ¬é…ç½®</h3>
<p>æˆ‘è´­ä¹°çš„æ˜¯é˜¿é‡Œäº‘çš„ ECS æœåŠ¡å™¨ï¼ŒcentOS ç³»ç»Ÿï¼Œæœ€ä½é…ç½®å°±å¯ä»¥äº†ï¼Œ1æ ¸ CPU ï¼Œ2G å†…å­˜ã€‚</p>

<p>è´­ä¹°å®ŒæœåŠ¡å™¨å¯ä»¥åœ¨é˜¿é‡Œäº‘çš„æ§åˆ¶å°ä¸Šçš„ <code class="highlighter-rouge">äº‘æœåŠ¡å™¨å®ä¾‹åˆ—è¡¨</code> æ‰¾åˆ°ï¼Œå…¶ä¸­ï¼š<br />
IP åœ°å€åˆ†ä¸ºå…¬ç½‘ IP å’Œå†…éƒ¨ç§æœ‰ IP åœ°å€ï¼Œè¿™é‡Œçš„ç§æœ‰ IP æ˜¯é˜¿é‡Œäº‘å†…ç½‘ä¸“ç”¨ IPï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨çš„æ˜¯å…¬ç½‘çš„ IP åœ°å€ï¼›</p>

<p>ç‚¹æ“ä½œé¡¹å¯ä»¥è¿›å…¥å®ä¾‹çš„é…ç½®ï¼Œå…¶ä¸­æˆ‘ä»¬éœ€è¦é…ç½®çš„æ˜¯ <code class="highlighter-rouge">æœ¬å®ä¾‹å®‰å…¨ç»„</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®‰å…¨ç»„è§„åˆ™é‡Œé¢æ·»åŠ æœåŠ¡å™¨éœ€è¦æš´éœ²çš„æ¥å£ï¼Œå¦åˆ™æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚ä¸€èˆ¬ä¼šæ ¹æ®è¿™ä¸ªä»¥åŠç»“åˆæœåŠ¡å™¨çš„é˜²ç«å¢™æ¥å¯¹æœåŠ¡å™¨çš„ç«¯å£è¿›è¡Œå®‰å…¨ç®¡ç†ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬æš´éœ²å‡º3001ã€8081ã€8082ï¼Œ80å¼€å¤´çš„ä½œä¸ºå‰ç«¯é¡¹ç›®çš„ç«¯å£ï¼Œ30å¼€å¤´çš„ä½œä¸ºæ¥å£æœåŠ¡çš„ç«¯å£ã€‚</p>

<p>é…ç½®å¥½ä¹‹åï¼Œåœ¨ç»ˆç«¯ iTerm2 å¯ä»¥è®¿é—®æœåŠ¡å™¨ï¼Œéœ€è¦è¾“å…¥æœåŠ¡å™¨çš„å¯†ç ï¼Œå¯†ç æ˜¯åœ¨ç”³è¯·å®ä¾‹çš„æ—¶å€™è®¾ç½®çš„ï¼Œå¯è‡ªè¡Œæ›´æ”¹ã€‚</p>

<p>è¿™é‡Œæˆ‘ä¸€èˆ¬ä¼šå°†è‡ªå·±ç”µè„‘çš„å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¹¶åœ¨è‡ªå·±ç”µè„‘ä¸Šè®¾ç½®å¿«æ·å‘½ä»¤ï¼Œå³ï¼Œå°†ç™»å½•çš„å‘½ä»¤å†™å…¥ .zshrc æ–‡ä»¶ä¸­ï¼Œå…·ä½“åšæ³•å…¥ä¸‹ï¼š<br />
åœ¨æœåŠ¡å™¨ ~ ç›®å½•ä¸‹è¿›å…¥ .ssh æ–‡ä»¶å¤¹ï¼Œæ–°å»º <code class="highlighter-rouge">authorized_keys</code> æ–‡ä»¶å¹¶æ·»åŠ å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå®¢æˆ·ç«¯çš„å…¬é’¥ç”Ÿæˆæ–¹æ³•å¯ä»¥ç™¾åº¦ä¸‹ã€‚ 
å¦ä¸€ä¸ªå°æŠ€å·§æ˜¯å°†ç™»å½•æœåŠ¡å™¨çš„å‘½ä»¤è®¾ç½®æˆåˆ«åï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯çš„ ~ ç›®å½•ä¸‹çš„ <code class="highlighter-rouge">.zshrc</code> æ–‡ä»¶ä¸­é…ç½® <code class="highlighter-rouge">alias aly="ssh root@39.108.2.88"</code></p>

<p>é…ç½®åï¼Œç›´æ¥åœ¨ iTerm2 ç»ˆç«¯é”®å…¥ aly ä¾¿å¯ç™»å½•åˆ°æœåŠ¡å™¨ã€‚</p>

<h3 id="å¸¸ç”¨è½¯ä»¶å®‰è£…">å¸¸ç”¨è½¯ä»¶å®‰è£…</h3>
<p>å®‰è£…ä»¥ä¸‹è½¯ä»¶æ–¹ä¾¿æˆ‘ä»¬æ“ä½œæœåŠ¡å™¨ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">yum</span> <span class="nx">install</span> <span class="nx">git</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">yum</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">install</span> <span class="nx">zsh</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">yum</span> <span class="nx">install</span> <span class="nx">epel</span><span class="o">-</span><span class="nx">release</span>
<span class="nx">yum</span> <span class="nx">install</span> <span class="nx">nodejs</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">pm2</span> <span class="o">-</span><span class="nx">g</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">wget</span> <span class="o">-</span><span class="nx">qO</span><span class="o">-</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//raw.githubusercontent.com/nvm-sh/nvm/v0.35.1/install.sh | bash</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">wget</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//dl.yarnpkg.com/rpm/yarn.repo -O /etc/yum.repos.d/yarn.repo</span>
<span class="nx">curl</span> <span class="o">--</span><span class="nx">silent</span> <span class="o">--</span><span class="nx">location</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//rpm.nodesource.com/setup_6.x | bash -</span>
<span class="nx">yum</span> <span class="nx">install</span> <span class="nx">yarn</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">yum</span> <span class="nx">install</span> <span class="nx">nginx</span>
</code></pre></div></div>

<h3 id="nginx-ç«¯å£æ˜ å°„">nginx ç«¯å£æ˜ å°„</h3>
<p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®‰è£…å®Œä¹‹åï¼Œå¯ä»¥ç”¨ <code class="highlighter-rouge">nginx -t</code> æ£€æµ‹ nginx çš„å…·ä½“å®‰è£…ä½ç½®ï¼š</p>
<blockquote>
  <p>nginx: configuration file /etc/nginx/nginx.conf test is successful</p>
</blockquote>

<p>æ ¹æ®å®‰è£…ä½ç½®ï¼ŒNginx çš„é»˜è®¤ç«¯å£æ˜¯80ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ <code class="highlighter-rouge">/etc/nginx/conf.d</code> ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€äº›æ–‡ä»¶ï¼Œæ¥åšç«¯å£æ˜ å°„ã€‚æ–‡ä»¶åå¯ä»¥æ ¹æ®é¡¹ç›®åç§°ä»¥åŠé…ç½®çš„ç«¯å£æ¥å‘½åï¼Œè¿™é‡Œåˆ›å»º <code class="highlighter-rouge">vue-app-8081.conf</code> å’Œ <code class="highlighter-rouge">react-app-8082.conf</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œ
vue-app-8081.conf çš„å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">server</span> <span class="p">{</span>
  <span class="nx">listen</span> <span class="mi">8081</span><span class="p">;</span> <span class="c1">// æµè§ˆå™¨è®¿é—®çš„ç«¯å£</span>
  <span class="nx">server_name</span> <span class="mf">39.108</span><span class="p">.</span><span class="mf">2.88</span><span class="p">;</span> <span class="c1">// æœåŠ¡å™¨åŸŸå</span>
  <span class="nx">root</span> <span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">vue</span><span class="o">-</span><span class="nx">app</span><span class="o">/</span><span class="nx">current</span><span class="o">/</span><span class="nx">dist</span><span class="o">/</span><span class="p">;</span> <span class="c1">// é¡¹ç›®ç›®å½•ï¼Œè¿™é‡Œçš„ä½ç½®è·Ÿä¸‹é¢ ecosystem.json æ–‡ä»¶çš„é…ç½®æœ‰å…³</span>
  <span class="nx">index</span> <span class="nx">index</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>æ¥ç€é‡å¯nginxï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nginx</span> <span class="o">-</span><span class="nx">s</span> <span class="nx">reload</span>
</code></pre></div></div>

<h2 id="äºŒå‰ç«¯é¡¹ç›®çš„éƒ¨ç½²">äºŒã€å‰ç«¯é¡¹ç›®çš„éƒ¨ç½²</h2>
<h3 id="å¾…éƒ¨ç½²çš„é¡¹ç›®">å¾…éƒ¨ç½²çš„é¡¹ç›®</h3>
<p>æœ¬æ¬¡éƒ¨ç½²çš„é¡¹ç›®æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ Vue å’Œ React çš„è„šæ‰‹æ¶ã€‚<br />
å¯åˆ†åˆ«é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç›´æ¥ç”Ÿæˆï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">vue</span> <span class="nx">create</span> <span class="nx">vue</span><span class="o">-</span><span class="nx">app</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">create</span><span class="o">-</span><span class="nx">react</span><span class="o">-</span><span class="nx">app</span> <span class="nx">react</span><span class="o">-</span><span class="nx">app</span>    
</code></pre></div></div>

<h3 id="æ·»åŠ -pm2-éƒ¨ç½²æ–‡ä»¶">æ·»åŠ  pm2 éƒ¨ç½²æ–‡ä»¶</h3>
<p>åœ¨æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ·»åŠ  <code class="highlighter-rouge">ecosystem.json</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">apps</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">vue-app</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// å¡«è¦éƒ¨ç½²çš„é¡¹ç›®åç§°</span>
            <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">app.js</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// å¯åŠ¨è„šæœ¬ï¼Œå‰ç«¯é¡¹ç›®å¥½åƒä¸éœ€è¦ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºçš„ app.js æ–‡ä»¶</span>
            <span class="dl">"</span><span class="s2">env</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">development</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">COMMON_VARIABLE</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">true</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">env_production</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="dl">"</span><span class="s2">deploy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// æœåŠ¡å™¨çš„ç®¡ç†å‘˜ï¼Œroot æ˜¯ç³»ç»Ÿé»˜è®¤ç®¡ç†å‘˜ï¼Œå¯ä»¥è®¾ç½®æ™®é€šæƒé™çš„ç®¡ç†å‘˜</span>
            <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">39.108.2.88</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// æœåŠ¡å™¨çš„åŸŸå</span>
            <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">8081</span><span class="p">,</span> <span class="c1">// æœåŠ¡å™¨è¦æš´éœ²çš„ç«¯å£å·</span>
            <span class="dl">"</span><span class="s2">ref</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">origin/master</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// é¡¹ç›®ä»“åº“çš„æ‹‰å–åˆ†æ”¯</span>
            <span class="dl">"</span><span class="s2">repo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">git@gitee.com:jeamnchan/vue-app.git</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// é¡¹ç›®ä»£ç ä»“åº“</span>
            <span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/www/vue-app</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// é¡¹ç›®åœ¨æœåŠ¡å™¨ç«¯çš„å­˜æ”¾ä½ç½®</span>
            <span class="dl">"</span><span class="s2">ssh_options</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">StrictHostKeyChecking=no</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">post-deploy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cnpm install &amp;&amp; yarn build</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// é¡¹ç›®éƒ¨ç½²å‘½ä»¤</span>
            <span class="dl">"</span><span class="s2">env</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä¿®æ”¹-packagejson-æ–‡ä»¶">ä¿®æ”¹ <code class="highlighter-rouge">package.json</code> æ–‡ä»¶</h3>
<p>ä¸»è¦æ˜¯åœ¨ scripts é‡Œæ·»åŠ ä¸€äº›ä¾¿æ·å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">deployinit</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pm2 deploy ecosystem.json production setup</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// é¦–æ¬¡éƒ¨ç½²éœ€è¦åˆå§‹åŒ–é¡¹ç›®</span>
<span class="dl">"</span><span class="s2">deploy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pm2 deploy ecosystem.json production</span><span class="dl">"</span> <span class="c1">// æ­£å¸¸éƒ¨ç½²</span>
</code></pre></div></div>

<h3 id="å°†é¡¹ç›®éƒ¨ç½²åˆ°-git-ä»“åº“">å°†é¡¹ç›®éƒ¨ç½²åˆ° Git ä»“åº“</h3>
<p>åœ¨ Github æˆ–è€… ç äº‘ åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼Œç”¨æ¥å­˜å‚¨é¡¹ç›®ä»£ç ï¼Œå…·ä½“æ­¥éª¤ä¸èµ˜è¿°ã€‚ã€‚</p>

<p>åˆ°è¿™é‡Œå°±ç®—å®Œæˆäº†ç®€å•çš„éƒ¨ç½²ï¼Œvue é¡¹ç›®ä¸­è¿è¡Œ <code class="highlighter-rouge">yarn deployinit</code> å³å¯å®Œæˆé¡¹ç›®çš„åˆå§‹åŒ–ï¼Œæ¥ç€è¿è¡Œ <code class="highlighter-rouge">yarn deploy</code> å³å¯ã€‚
æµè§ˆå™¨è®¿é—® <code class="highlighter-rouge">39.108.2.88:8081</code> å¯çœ‹åˆ°æ•ˆæœã€‚
æœ‰æ¡ä»¶çš„è´­ä¹°åŸŸåï¼Œå°†åŸŸåè§£æåˆ°å¯¹åº”çš„ç«¯å£å³å¯ã€‚ç”±äºåŸŸåéœ€è¦å¤‡æ¡ˆï¼Œè¿™é‡Œå°±çœç•¥äº†ã€‚</p>

<h2 id="ä¸‰node-æ¥å£éƒ¨ç½²">ä¸‰ã€Node æ¥å£éƒ¨ç½²</h2>
<p>node æœåŠ¡çš„éƒ¨ç½²æµç¨‹ä¹Ÿå·®ä¸å¤šï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ªç®€å•çš„ node è„šæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello server</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3001</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is running on 3001</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>æ·»åŠ  <code class="highlighter-rouge">ecosystem.json</code> æ–‡ä»¶ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="dl">"</span><span class="s2">apps</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node-server</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">app.js</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">env</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">development</span><span class="dl">"</span><span class="p">,</span>
                <span class="dl">"</span><span class="s2">COMMON_VARIABLE</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">true</span><span class="dl">"</span>
            <span class="p">},</span>
            <span class="dl">"</span><span class="s2">env_production</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="dl">"</span><span class="s2">deploy</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">39.108.2.87</span><span class="dl">"</span><span class="p">],</span>
            <span class="dl">"</span><span class="s2">port</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3001</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">ref</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">origin/master</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">repo</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">git@gitee.com:jeamnchan/node-server.git</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/www/node-server</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">ssh_options</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">StrictHostKeyChecking=no</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">post-deploy</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pm2 start app.js</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">env</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">NODE_ENV</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨ <code class="highlighter-rouge">/etc/nginx/conf.d</code> ç›®å½•ä¸‹ï¼Œæ–°å»º <code class="highlighter-rouge">node-server-3001.conf</code> æ–‡ä»¶ï¼Œ</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">upstream</span> <span class="nx">node</span><span class="o">-</span><span class="nx">server</span> <span class="p">{</span>
    <span class="nx">server</span> <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3001</span><span class="p">;</span> <span class="err">#è¿™é‡Œçš„ç«¯å£å·å†™ä½ </span><span class="nx">node</span><span class="p">.</span><span class="nx">js</span><span class="err">è¿è¡Œçš„ç«¯å£å·</span>
    <span class="nx">keepalive</span> <span class="mi">64</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">server</span> <span class="p">{</span>
    <span class="nx">listen</span> <span class="mi">3001</span><span class="p">;</span>
    <span class="nx">server_name</span> <span class="mf">39.108</span><span class="p">.</span><span class="mf">2.87</span><span class="p">;</span> <span class="err">#è¿™é‡Œæ˜¯ä½ çš„æœåŠ¡å™¨åç§°ï¼Œä¹Ÿå°±æ˜¯åˆ«äººè®¿é—®ä½ æœåŠ¡çš„</span><span class="nx">ip</span><span class="err">åœ°å€æˆ–åŸŸåï¼Œå¯ä»¥å†™å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€</span>

    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="nx">proxy_set_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Real</span><span class="o">-</span><span class="nx">IP</span> <span class="nx">$remote_addr</span><span class="p">;</span>
        <span class="nx">proxy_set_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Forwarded</span><span class="o">-</span><span class="nx">For</span> <span class="nx">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="nx">proxy_set_header</span> <span class="nx">Host</span> <span class="nx">$http_host</span><span class="p">;</span>
        <span class="nx">proxy_set_header</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Nginx</span><span class="o">-</span><span class="nb">Proxy</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">proxy_set_header</span> <span class="nx">Connection</span> <span class="dl">""</span><span class="p">;</span>
        <span class="nx">proxy_pass</span> <span class="na">http</span><span class="p">:</span><span class="c1">//node-server; # è¿™é‡Œè¦å’Œæœ€ä¸Šé¢upstreamåçš„åº”ç”¨åä¸€è‡´ï¼Œå¯ä»¥è‡ªå®šä¹‰</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>node æ¥å£æ²¡æ€ä¹ˆå»å†™ï¼Œåªæ˜¯å¤§æ¦‚è·‘é€šäº†æ•´ä¸ªæµç¨‹ã€‚æœ‰ç©ºå†æ•´æ¥å£è¿™å—â€¦</p>
:ET